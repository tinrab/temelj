<p align="center">
  <h1 align="center" style="text-decoration:none;">@temelj/mdx</h1>
  <br/>
  <p align="center">
    Utilities for working with MDX.
  </p>
</p>

<p align="center">
  <a href="https://twitter.com/tinrab" rel="nofollow"><img src="https://img.shields.io/badge/created%20by-@tinrab-1d9bf0.svg" alt="Created by Tin Rabzelj"></a>
  <a href="https://jsr.io/@temelj/mdx" rel="nofollow"><img src="https://jsr.io/badges/@temelj/mdx" alt="jsr"></a>
  <a href="https://opensource.org/licenses/MIT" rel="nofollow"><img src="https://img.shields.io/github/license/tinrab/temelj" alt="License"></a>
</p>

<div align="center">
  <a href="https://jsr.io/@temelj/mdx">jsr</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://www.npmjs.com/package/@temelj/mdx">npm</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://github.com/tinrab/temelj/issues/new">Issues</a>
  <span>&nbsp;&nbsp;•&nbsp;&nbsp;</span>
  <a href="https://twitter.com/tinrab">@tinrab</a>
  <br />
</div>

<br/>
<br/>

## Installation

```sh
# npm
$ npm install @temelj/mdx
# jsr
$ deno add jsr:@temelj/mdx # or jsr add @temelj/mdx
```

## Compile

```ts
import { expect, test } from "vitest";
import {
  type HastElement,
  headingIdPlugin,
  MdxCompiler,
  syntaxHighlightPlugin,
  treeProcessorPlugin,
} from "@temelj/mdx";
import { z } from "zod";

const compiler = new MdxCompiler()
  .withRehypePlugin(headingIdPlugin, {
    prefix: "h-",
  })
  .withRehypePlugin(syntaxHighlightPlugin, {
    highlight: {},
    lineNumbers: {},
    commandLine: {},
    shikiHastOptions: {
      // themes: {
      //   light: lightTheme,
      //   dark: darkTheme,
      // },
    },
  });

const source = `
---
title: Demo
---
# Hello

This will compile MDX to a render-able artifact.
With '@temelj/mdx-react' you can render it in an React app.

You can validate the frontmatter with a zod schema.

There are a few useful plugins:
- Use 'headingIdPlugin' to update heading tags (h1, h2, etc.) with IDs generated by slugging their text content.
This is useful for linking to headings in a page.
- Use 'syntaxHighlightPlugin' to highlight code blocks using [Shiki](https://github.com/shikijs/shiki).
You can highlight individual lines, show line numbers, or display a prompt.
- Use 'treeProcessorPlugin' to modify the HAST tree.
For example, change image URLs to point to a CDN.

\`\`\`bash {"commandLine": "0"}
whoamai
@temelj/mdx
\`\`\`
`.trim();
const artifact = await compiler.compile(
  source,
  {
    frontmatterOnly: false,
    mdxOptions: {
      rehypePlugins: [
        [
          treeProcessorPlugin,
          {
            process: (node: HastElement) =>
              assert(typeof node.type === "string"),
          },
        ],
      ],
    },
  },
  z.object({
    title: z.string(),
  }),
);
assert(artifact.compiled !== undefined);
assertEquals(artifact.frontmatter, {
  title: "Demo",
});
```

## About

This package is part of [Temelj](https://github.com/tinrab/temelj) - a big
standard library for TypeScript.
